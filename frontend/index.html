<!DOCTYPE html>
<html>
<head>
    <title>AI Interview Assistant</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f172a, #1e3a8a, #7c3aed);
            min-height: 100vh;
            color: white;
        }

        .wrapper {
            max-width: 1100px;
            margin: 40px auto;
            padding: 20px;
        }

        .card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(25px);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            transition: 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
        }

        h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        h2 {
            margin-bottom: 15px;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 14px;
            margin: 10px 0 20px 0;
            border-radius: 12px;
            border: none;
            outline: none;
            font-size: 14px;
        }

        button {
            background: linear-gradient(45deg, #6366f1, #ec4899);
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s ease;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(236,72,153,0.6);
        }

        .result-box {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin-top: 15px;
            white-space: pre-wrap;
            min-height: 60px;
        }

        .spinner {
            display: none;
            margin-top: 10px;
            font-size: 14px;
            color: #facc15;
        }

        .analytics-grid {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .metric {
            flex: 1;
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            font-size: 18px;
        }

        canvas {
            background: white;
            border-radius: 15px;
            padding: 10px;
            margin-top: 20px;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            font-size: 13px;
            opacity: 0.8;
        }
    </style>
</head>

<body>

<div class="wrapper">

    <div class="card">
        <h1>ü§ñ AI Interview Assistant Dashboard</h1>

        <h2>Generate Interview</h2>

        <input id="role" placeholder="Enter Role (e.g Data Scientist)">
        <select id="difficulty">
            <option>Easy</option>
            <option>Medium</option>
            <option>Hard</option>
        </select>

        <button onclick="generate()">Generate Questions</button>
        <div class="spinner" id="genSpinner">‚ö° Generating AI questions...</div>

        <div class="result-box" id="questions"></div>
    </div>

    <div class="card">
        <h2>Your Answer</h2>
        <textarea id="answer" rows="5" placeholder="Type your answer here..."></textarea>

        <button onclick="submitAnswer()">Submit Answer</button>
        <div class="spinner" id="evalSpinner">üß† AI evaluating your answer...</div>

        <div class="result-box" id="feedback"></div>
    </div>

    <div class="card">
        <h2>üìä Analytics Dashboard</h2>

        <div class="analytics-grid">
            <div class="metric">
                <h3>Total Attempts</h3>
                <p id="totalAttempts">0</p>
            </div>

            <div class="metric">
                <h3>Average Score</h3>
                <p id="avgScore">0</p>
            </div>
        </div>

        <canvas id="scoreChart"></canvas>
    </div>

    <div class="footer">
        Built with ‚ù§Ô∏è using FastAPI + AI
    </div>

</div>

<script>
let currentQuestion = "";

async function generate() {
    document.getElementById("genSpinner").style.display = "block";

    const role = document.getElementById("role").value;
    const difficulty = document.getElementById("difficulty").value;

    const res = await fetch(`http://127.0.0.1:8000/interview/questions?role=${role}&difficulty=${difficulty}`);
    const data = await res.json();

    document.getElementById("genSpinner").style.display = "none";

    currentQuestion = data.questions;
    typeEffect("questions", data.questions);
}

async function submitAnswer() {
    document.getElementById("evalSpinner").style.display = "block";

    const role = document.getElementById("role").value;
    const difficulty = document.getElementById("difficulty").value;
    const answer = document.getElementById("answer").value;

    const res = await fetch("http://127.0.0.1:8000/interview/evaluate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            role,
            difficulty,
            question: currentQuestion,
            answer
        })
    });

    const data = await res.json();

    document.getElementById("evalSpinner").style.display = "none";

    typeEffect("feedback", data.feedback);
    loadAnalytics();
}

function typeEffect(id, text) {
    const el = document.getElementById(id);
    el.innerHTML = "";
    let i = 0;
    function typing() {
        if (i < text.length) {
            el.innerHTML += text.charAt(i);
            i++;
            setTimeout(typing, 8);
        }
    }
    typing();
}

async function loadAnalytics() {
    const res = await fetch("http://127.0.0.1:8000/interview/analytics");
    const data = await res.json();

    document.getElementById("totalAttempts").innerText = data.total_attempts;
    document.getElementById("avgScore").innerText = data.average_score;

    const scores = data.history.map(h => h.score);

    const ctx = document.getElementById("scoreChart").getContext("2d");

    new Chart(ctx, {
        type: "line",
        data: {
            labels: scores.map((_, i) => "Attempt " + (i + 1)),
            datasets: [{
                label: "Score Progress",
                data: scores,
                borderColor: "#6366f1",
                backgroundColor: "rgba(99,102,241,0.2)",
                tension: 0.4
            }]
        }
    });
}

loadAnalytics();
</script>

</body>
</html>